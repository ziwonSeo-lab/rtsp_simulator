# RTSP 시뮬레이터 v2 - 제품 요구사항 명세서 (PRD)

## 1. 제품 개요

### 1.1 제품명
**RTSP 시뮬레이터 v2** - 고성능 멀티스레드 영상 처리 시뮬레이터

### 1.2 제품 목적
실시간 RTSP 스트림 및 로컬 비디오 파일을 처리하여 AI 기반 영상 분석, 블러 처리, 그리고 고품질 영상 저장을 수행하는 통합 솔루션

### 1.3 타겟 사용자
- **보안 시스템 개발자**: CCTV 영상 처리 시스템 개발
- **AI 연구원**: 영상 데이터 전처리 및 분석
- **영상 처리 엔지니어**: 실시간 영상 스트리밍 처리
- **시스템 관리자**: 영상 모니터링 시스템 운영

### 1.4 핵심 가치 제안
- **고성능**: 멀티스레딩으로 최대 10개 스트림 동시 처리
- **확장성**: 플러그인 방식의 AI 모듈 지원
- **안정성**: 스레드별 독립적인 리소스 관리
- **사용성**: 직관적인 GUI와 실시간 모니터링

## 2. 기능 요구사항

### 2.1 핵심 기능

#### 2.1.1 영상 입력 처리
- **RTSP 스트림 지원**
  - 실시간 RTSP URL 연결
  - 자동 재연결 및 오류 복구
  - 다중 스트림 동시 처리 (최대 10개)
  
- **로컬 파일 지원**
  - MP4, AVI, MKV, MOV 등 주요 비디오 포맷
  - 파일 반복 재생 옵션
  - 배치 파일 처리

#### 2.1.2 실시간 영상 처리
- **AI 기반 블러 처리**
  - YOLO 기반 객체 탐지
  - 얼굴/헤드 영역 자동 블러
  - 커스텀 블러 모듈 플러그인 지원
  
- **오버레이 정보 추가**
  - GPS 좌표 정보 (위도/경도)
  - 실시간 타임스탬프
  - 스레드/카메라 식별 정보
  - 처리 상태 표시

#### 2.1.3 영상 저장 시스템
- **다양한 출력 포맷**
  - 이미지: JPEG, PNG
  - 비디오: MP4, AVI, MKV, WebM
  
- **고급 비디오 인코딩**
  - H.264, H.265, VP9, AV1 코덱 지원
  - FFmpeg 기반 고품질 압축
  - 하드웨어 가속 지원 (NVIDIA CUDA, Intel QSV)
  
- **저장 옵션**
  - 프레임별/시간별 저장 간격 설정
  - 자동 파일명 생성 (타임스탬프 기반)
  - 배치 단위 비디오 저장

### 2.2 사용자 인터페이스

#### 2.2.1 메인 GUI
- **설정 패널**
  - 스크롤 가능한 통합 설정 인터페이스
  - 실시간 설정 변경 및 적용
  - 설정 저장/로드 기능
  
- **실시간 미리보기**
  - 스레드별 개별 미리보기 창
  - 처리 전/후 영상 비교
  - 확대/축소 및 프레임 정보 표시

#### 2.2.2 모니터링 대시보드
- **성능 모니터링**
  - 실시간 FPS 표시
  - CPU, RAM, GPU 사용률 모니터링
  - 처리 지연시간 및 큐 상태
  
- **통계 정보**
  - 처리된 프레임 수 및 손실률
  - 저장된 파일 통계
  - 오류 및 재연결 횟수

### 2.3 고급 기능

#### 2.3.1 성능 최적화
- **고성능 모드**
  - 불필요한 로깅/통계 비활성화
  - 메모리 복사 최소화
  - GPU 메모리 효율적 관리
  
- **프로파일링 도구**
  - 병목 지점 자동 탐지
  - 처리 단계별 시간 측정
  - 성능 리포트 생성

#### 2.3.2 확장성 지원
- **플러그인 아키텍처**
  - 사용자 정의 블러 모듈 로드
  - HeadBlurrer 클래스 인터페이스
  - 런타임 모듈 교체

- **설정 관리**
  - 환경변수 기반 기본 설정
  - JSON 설정 파일 지원
  - 프로파일별 설정 저장

## 3. 비기능 요구사항

### 3.1 성능 요구사항
- **처리 성능**: 설정 FPS의 90% 이상 달성
- **동시성**: 최대 10개 스트림 동시 처리
- **메모리 효율성**: 장시간 실행 시 메모리 누수 없음
- **응답성**: GUI 업데이트 지연 100ms 이내

### 3.2 안정성 요구사항
- **오류 복구**: 네트워크 오류 시 자동 재연결
- **예외 처리**: 모든 예외 상황에 대한 적절한 처리
- **리소스 관리**: 스레드별 독립적인 리소스 정리
- **데이터 무결성**: 저장 중 오류 시 파일 손상 방지

### 3.3 호환성 요구사항
- **운영체제**: Windows, macOS, Linux 지원
- **Python 버전**: 3.7 이상
- **하드웨어**: 최소 4GB RAM, 멀티코어 CPU 권장
- **의존성**: 표준 라이브러리 및 검증된 오픈소스 패키지

### 3.4 사용성 요구사항
- **직관적 UI**: 비전문가도 쉽게 사용 가능
- **실시간 피드백**: 모든 작업에 즉시 시각적 피드백
- **오류 메시지**: 명확하고 실행 가능한 오류 안내
- **도움말**: 내장된 도움말 및 예제

## 4. 기술 명세

### 4.1 시스템 아키텍처
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   GUI Layer     │    │  Processing     │    │   Storage       │
│   (Tkinter)     │◄──►│   Layer         │◄──►│   Layer         │
│                 │    │ (Multi-thread)  │    │  (FFmpeg)       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Configuration │    │    AI Module    │    │   Monitoring    │
│     Manager     │    │   (Pluggable)   │    │     System      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 4.2 핵심 컴포넌트

#### 4.2.1 RTSPProcessor
- **역할**: 멀티스레드 영상 처리 엔진
- **구성**: 스레드별 독립적인 프레임 처리 파이프라인
- **특징**: 큐 기반 스레드 간 통신

#### 4.2.2 EnhancedFFmpegVideoWriter
- **역할**: 고급 비디오 인코딩 래퍼
- **구성**: FFmpeg 프로세스 관리 및 에러 처리
- **특징**: 하드웨어 가속 및 실시간 인코딩

#### 4.2.3 ResourceMonitor
- **역할**: 시스템 리소스 실시간 모니터링
- **구성**: CPU, RAM, GPU 사용률 추적
- **특징**: 히스토리 데이터 및 통계 제공

#### 4.2.4 PerformanceProfiler
- **역할**: 성능 병목 지점 분석
- **구성**: 함수별 실행 시간 측정
- **특징**: 실시간 프로파일링 및 리포트 생성

### 4.3 데이터 플로우
```
RTSP/File Input → Frame Reading → AI Processing → Overlay Addition 
     ↓                                                    ↓
Queue Management ← Statistics Update ← Preview Queue ← Frame Storage
     ↓                    ↓                 ↓              ↓
GUI Update ← Performance Monitor ← Resource Monitor ← File Output
```

## 5. 제약사항 및 가정

### 5.1 기술적 제약사항
- **Python GIL**: 진정한 병렬 처리 제한 (I/O 바운드 작업 중심)
- **FFmpeg 의존성**: 외부 프로그램 설치 필요
- **GPU 메모리**: AI 모델 로드 시 충분한 VRAM 필요
- **네트워크 대역폭**: RTSP 스트림 품질에 따른 대역폭 요구

### 5.2 운영 환경 가정
- **안정된 네트워크**: RTSP 스트림의 안정적인 연결
- **충분한 저장공간**: 영상 저장을 위한 디스크 공간
- **권한 설정**: 파일 읽기/쓰기 권한 확보
- **하드웨어 호환성**: GPU 드라이버 및 CUDA 환경 구성

## 6. 성공 지표

### 6.1 성능 지표
- **처리 성능**: 6개 카메라 × 15 FPS = 90 FPS 달성
- **안정성**: 24시간 연속 운영 시 오류율 1% 미만
- **리소스 효율성**: CPU 사용률 80% 이하 유지
- **응답성**: GUI 상호작용 지연 100ms 이하

### 6.2 사용성 지표
- **설정 완료 시간**: 초기 설정 완료까지 5분 이내
- **오류 복구 시간**: 네트워크 오류 후 자동 복구 30초 이내
- **학습 곡선**: 신규 사용자 기본 기능 익힘 1시간 이내

### 6.3 품질 지표
- **코드 커버리지**: 단위 테스트 커버리지 80% 이상
- **문서화 수준**: 모든 주요 기능에 대한 사용법 문서화
- **호환성**: 3개 주요 OS에서 정상 동작 확인

## 7. 위험 요소 및 대응 방안

### 7.1 기술적 위험
- **메모리 누수**: 장시간 실행 시 메모리 사용량 증가
  - 대응: 정기적인 메모리 모니터링 및 리소스 정리
  
- **스레드 동기화 문제**: 멀티스레드 환경에서의 데이터 경합
  - 대응: 스레드별 독립적인 리소스 관리 및 큐 기반 통신

### 7.2 운영 위험
- **네트워크 불안정**: RTSP 연결 끊김 및 품질 저하
  - 대응: 자동 재연결 로직 및 오류 허용 범위 설정
  
- **저장공간 부족**: 대용량 영상 파일로 인한 디스크 부족
  - 대응: 저장공간 모니터링 및 자동 정리 기능

### 7.3 사용자 위험
- **설정 복잡성**: 다양한 옵션으로 인한 설정 어려움
  - 대응: 기본값 최적화 및 단계별 설정 가이드 제공
  
- **성능 기대치**: 하드웨어 제약으로 인한 성능 미달
  - 대응: 시스템 요구사항 명확 제시 및 성능 진단 도구 제공

## 8. 향후 발전 계획

### 8.1 단기 계획 (3일) ✅ **완료**
- **성능 최적화**: ~~현재 87 FPS → 90 FPS 목표 달성~~ **✅ 달성완료**
  - 프레임 처리 병목 해결 (가장 큰 성능 이슈)
  - 시작시간 계산 로직 개선 (첫 프레임 입력 시간 기준)
  - 6대 카메라 × 15 FPS = 90 FPS 목표 성공적 달성
- **UI/UX 개선**: 사용자 피드백 기반 인터페이스 개선
- **테스트 자동화**: CI/CD 파이프라인 구축

### 8.2 중기 계획 (6개월)
- **클라우드 지원**: 원격 RTSP 스트림 및 클라우드 저장
- **AI 모델 확장**: 객체 탐지, 이상 행동 탐지 등 추가 모델
- **모바일 지원**: 웹 기반 모니터링 인터페이스

### 8.3 장기 계획 (1년)
- **엣지 컴퓨팅**: 임베디드 시스템 지원
- **실시간 분석**: 스트리밍 분석 및 알람 시스템
- **상용화**: 라이센스 및 지원 서비스 체계 구축 
